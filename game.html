import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";

// --- Pastel Fantasy Background for Games ---
const BackgroundAura: React.FC = () => {
  const [windowSize, setWindowSize] = useState({ width: 0, height: 0 });

  useEffect(() => {
    setWindowSize({ width: window.innerWidth, height: window.innerHeight });
  }, []);

  return (
    <div className="fixed inset-0 overflow-hidden -z-10 bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100">
      {Array.from({ length: 25 }).map((_, i) => (
        <motion.div
          key={`sparkle-${i}`}
          className="absolute w-2 h-2 bg-white rounded-full opacity-70 shadow-lg"
          initial={{ x: Math.random() * windowSize.width, y: Math.random() * windowSize.height, scale: 0 }}
          animate={{ y: [-20, windowSize.height], scale: [0, 1, 0] }}
          transition={{ duration: 12 + Math.random() * 10, repeat: Infinity, ease: "easeInOut" }}
        />
      ))}
      {Array.from({ length: 6 }).map((_, i) => (
        <motion.div
          key={`butterfly-${i}`}
          className="absolute text-2xl"
          style={{ left: `${Math.random() * 80}%`, top: `${Math.random() * 80}%` }}
          animate={{ x: [0, 40, -40, 0], y: [0, -30, 30, 0], rotate: [0, 10, -10, 0] }}
          transition={{ duration: 15, repeat: Infinity, ease: "easeInOut" }}
        >
          ü¶ã
        </motion.div>
      ))}
      {Array.from({ length: 3 }).map((_, i) => (
        <motion.div
          key={`bunny-${i}`}
          className="absolute text-3xl"
          style={{ left: `${20 + i * 25}%`, bottom: "0px" }}
          animate={{ y: [0, -12, 0] }}
          transition={{ duration: 5 + i, repeat: Infinity, ease: "easeInOut" }}
        >
          üêá
        </motion.div>
      ))}
    </div>
  );
};

// --- Generic Game Container ---
interface GameContainerProps {
  title: string;
  instructions: string;
  children: React.ReactNode;
}

const GameContainer: React.FC<GameContainerProps> = ({ title, instructions, children }) => (
  <div className="relative w-full h-screen flex flex-col items-center justify-center p-4">
    <BackgroundAura />
    <motion.h2
      initial={{ opacity: 0, y: -10 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 1 }}
      className="text-4xl font-bold text-purple-600 drop-shadow mb-6"
    >
      {title}
    </motion.h2>
    <p className="text-center text-gray-700 mb-4">{instructions}</p>
    {children}
  </div>
);

// --- Sudoku Game ---
export const SudokuGame: React.FC = () => {
  const [grid, setGrid] = useState<number[][]>(Array.from({ length: 9 }, () => Array(9).fill(0)));

  const fillRandom = () => {
    const newGrid: number[][] = Array.from({ length: 9 }, () =>
      Array.from({ length: 9 }, () => Math.floor(Math.random() * 9) + 1)
    );
    setGrid(newGrid);
  };

  return (
    <GameContainer title="üß© Sudoku üß©" instructions="Fill the grid so every row, column, and 3x3 box contains the numbers 1-9. Click Auto-Fill to see solving logic in action.">
      <div className="grid grid-cols-9 gap-1">
        {grid.map((row, i) =>
          row.map((num, j) => (
            <div
              key={`${i}-${j}`}
              className="w-12 h-12 flex items-center justify-center bg-pink-100/60 border border-white/30 rounded shadow-md text-xl font-bold text-purple-800"
            >
              {num !== 0 ? num : ""}
            </div>
          ))
        )}
      </div>
      <button
        onClick={fillRandom}
        className="mt-6 px-6 py-2 bg-purple-300/80 rounded-lg shadow hover:bg-purple-400 transition-colors"
      >
        Auto-Fill (Demo)
      </button>
    </GameContainer>
  );
};

// --- Tic Tac Toe Game ---
export const TicTacToeGame: React.FC = () => {
  const [board, setBoard] = useState<string[]>(Array(9).fill(""));
  const makeMove = (i: number) => {
    setBoard((prev) => prev.map((cell, idx) => (idx === i && cell === "" ? "X" : cell)));
  };

  return (
    <GameContainer title="‚ùå Tic Tac Toe ‚≠ï" instructions="Click a square to place your X. Try to get three in a row!">
      <div className="grid grid-cols-3 gap-2">
        {board.map((cell, i) => (
          <div
            key={i}
            onClick={() => makeMove(i)}
            className="w-20 h-20 flex items-center justify-center bg-blue-100/60 border rounded shadow-md text-2xl font-bold text-blue-700 cursor-pointer"
          >
            {cell}
          </div>
        ))}
      </div>
    </GameContainer>
  );
};

// --- Connect Four Game ---
export const ConnectFourGame: React.FC = () => {
  const [grid, setGrid] = useState<string[][]>(Array.from({ length: 6 }, () => Array(7).fill("")));
  const dropPiece = (col: number) => {
    setGrid((prev) => {
      const newGrid = prev.map((r) => [...r]);
      for (let r = 5; r >= 0; r--) {
        if (!newGrid[r][col]) {
          newGrid[r][col] = "üî¥";
          break;
        }
      }
      return newGrid;
    });
  };

  return (
    <GameContainer title="üî¥ Connect Four üü°" instructions="Click a column to drop your piece. Connect 4 in a row to win!">
      <div className="grid grid-rows-6 grid-cols-7 gap-1">
        {grid.map((row, i) =>
          row.map((cell, j) => (
            <div
              key={`${i}-${j}`}
              onClick={() => dropPiece(j)}
              className="w-12 h-12 flex items-center justify-center bg-green-100/60 border rounded shadow-md text-xl cursor-pointer"
            >
              {cell}
            </div>
          ))
        )}
      </div>
    </GameContainer>
  );
};

// --- 2048 Game ---
export const Game2048: React.FC = () => {
  const [grid, setGrid] = useState<number[][]>(Array.from({ length: 4 }, () => Array(4).fill(0)));

  const addRandom = () => {
    setGrid((prev) => {
      const newGrid = prev.map((r) => [...r]);
      const emptyCells: [number, number][] = [];
      newGrid.forEach((r, i) => r.forEach((c, j) => !c && emptyCells.push([i, j])));
      if (emptyCells.length > 0) {
        const [i, j] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
        newGrid[i][j] = 2;
      }
      return newGrid;
    });
  };

  return (
    <GameContainer title="2048 üé≤" instructions="Combine tiles of the same number to reach 2048. Click 'Add Tile' for demo.">
      <div className="grid grid-cols-4 gap-2">
        {grid.map((row, i) =>
          row.map((num, j) => (
            <div
              key={`${i}-${j}`}
              className="w-16 h-16 flex items-center justify-center bg-yellow-100/60 border rounded shadow-md text-xl font-bold text-yellow-800"
            >
              {num !== 0 ? num : ""}
            </div>
          ))
        )}
      </div>
      <button
        onClick={addRandom}
        className="mt-4 px-4 py-2 bg-yellow-300/80 rounded-lg shadow hover:bg-yellow-400 transition-colors"
      >
        Add Tile (Demo)
      </button>
    </GameContainer>
  );
};
